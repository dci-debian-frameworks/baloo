From 2fd777302ef070dcba04f1142ff7c494ff0b8891 Mon Sep 17 00:00:00 2001
From: Vishesh Handa <me@vhanda.in>
Date: Sat, 29 Mar 2014 17:47:59 +0100
Subject: [PATCH 22/56] Cleaner: Do faster mimetype detection

Otherwise we consume just way too much io
---
 src/file/cleaner/cleaner.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/file/cleaner/cleaner.cpp b/src/file/cleaner/cleaner.cpp
index d64a39d..21eb1cd 100644
--- a/src/file/cleaner/cleaner.cpp
+++ b/src/file/cleaner/cleaner.cpp
@@ -64,7 +64,9 @@ void Cleaner::start()
             removeIt = true;
         }
 
-        QString mimetype = KMimeType::findByUrl(QUrl::fromLocalFile(url))->name();
+        // vHanda FIXME: Perhaps we want to get the proper mimetype from xapian?
+        QString mimetype = KMimeType::findByUrl(QUrl::fromLocalFile(url), 0,
+                                                true /*local*/, true /*fast*/)->name();
         if (!config.shouldMimeTypeBeIndexed(mimetype)) {
             removeIt = true;
         }
-- 
1.9.1

